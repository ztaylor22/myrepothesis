---
title: "ThesisDataWrangling"
output: html_document
date: '2022-10-10'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("quantmod")
library(quantmod)
```

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
```


```{r}
stock_list <- c("TSLA", "TM", "POAHY", "VWAPY", "MBGYY", "GM", "F", "BMWYY", "STLA", "HMC", "RACE", "RIVN", "HYMTF", "NIO", "LCID", "TTM")
from_date <- "2022-7-27"
to_date <- "2022-9-4"
frequency <- "daily"

for (idx in seq(length(stock_list))){
  stock_index = stock_list[idx]
  getSymbols(stock_index, src = "yahoo",from=from_date,to=to_date, frequency=frequency)
  temp_df = as.data.frame(get(stock_index))
  temp_df$Date = row.names(temp_df)
  temp_df$Index = stock_index
  row.names(temp_df) = NULL
  colnames(temp_df) = c("Open", "High", "Low", "Close", 
                        "Volume", "Adjusted", "Date", "Index")
  temp_df = temp_df[c("Date", "Index", "Open","Close")]
  
  temp_df <- temp_df %>% #Adding Difference & Percent Change to master_df 
    mutate(Difference=Open-Close) %>%
    mutate(PercentChange=Difference/Close)
  master_df = rbind(master_df, temp_df)
  
#I want to add a line of code here that creates a unique df for each company as the for loop iterates through each stock_list index. EX:TSLA_df, TM_df, POAHY_df. This is currently a very inefficient way to do that.
#This is not necessary...just use groupby/filtering on the index before piping to ggplot
  if (stock_list[idx] == "TSLA"){
    TSLA_df <- temp_df
    TSLA_df %>% select(Date, Open, Close, Difference, PercentChange)
    colnames(TSLA_df) <- c('Date','TSLA_Open','TSLA_Close','TSLA_Difference','TSLA_PercentChange')
  }
  if (stock_list[idx] == "TM"){
    TM_df <- temp_df
    TM_df %>% select(Date, Open, Close, Difference, PercentChange)
    colnames(TM_df) <- c('Date','TM_Open','TM_Close','TM_Difference','TM_PercentChange')
  }
  #I would like to automate this so I don't need to hard code each if statement...
}
master_df
```

#Make a data table with each comapny and their close price
#Then combine the tables so you have one big table with y axis being the data and x axis being close price

#Then do the same as the above two but have the x axis be change in price

#Work with Liv to make this code more efficient
```{r}
TSLA_df
```

```{r}
ggplot(TM_df, aes(x=Date,y=TM_PercentChange)) + geom_point() + labs(x="Date",y="Close")
```

```{r}
ggplot(master_df, aes(x=Date,y=PercentChange)) + geom_point(aes(color=Index)) + labs(x="Date",y="Close")
#Ideas: add a vertical line for the dates of interest
#Color code companies based on their group: Group 1, Group 2, Group 3
```


```{r}



  if (stock_list[idx] == "POAHY"){
    POAHY_df <- temp_df
  }
  if (stock_list[idx] == "VWAPY"){
    VWAPY_df <- temp_df
  }
  if (stock_list[idx] == "MBGYY"){
    MBGYY_df <- temp_df
  }
  if (stock_list[idx] == "GM"){
    GM_df <- temp_df
  }
  if (stock_list[idx] == "F"){
    F_df <- temp_df
  }
  if (stock_list[idx] == "BMWYY"){
    BMWYY_df <- temp_df
  }
  if (stock_list[idx] == "STLA"){
    STLA_df <- temp_df
  }
  if (stock_list[idx] == "HMC"){
    HMC_df <- temp_df
  }
  if (stock_list[idx] == "RACE"){
    RACE_df <- temp_df
  }
  if (stock_list[idx] == "RIVN"){
    RIVN_df <- temp_df
  }
  if (stock_list[idx] == "HYMTF"){
    HYMTF_df <- temp_df
  }
  if (stock_list[idx] == "NIO"){
    NIO_df <- temp_df
  }
  if (stock_list[idx] == "LCID"){
    LCID_df <- temp_df
  }
  if (stock_list[idx] == "TTM"){
    TTM_df <- temp_df
  }



```



## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
getSymbols("TSLA", from="2022-7-27", to="2022-9-4", periodicity="daily", src="yahoo")
#quantmod's getSymbols function only works with daily, weekly, and monthly
chartSeries(TSLA, theme=chartTheme("white"))
#addMACD() What does this line do?
summary(cars)
```
```{r}

#ticker <- "GM"
#date_from <- "2022-7-27"
#date_to <- "2022-9-4"
#frequency <- "daily"

StockDataIteration <- function(ticker, date_from, date_to, frequency)
{
  getSymbols(ticker, from=date_from, to=date_to, periodicity=frequency, src="yahoo")
  chart <- chartSeries(ticker, theme=chartTheme("white"))
  return(chart)

}
```

```{r}
StockDataIteration("GM","2022-7-27","2022-9-4","daily")
#Need to do some research on writing functions in R
#Need to then create a for loop where all of this data is added to a datatable as a new column
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
